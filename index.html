<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AR Experience with Universal Sound</title>
    <style>
        body { margin: 0; overflow: hidden; }
        model-viewer {
            width: 100vw;
            height: 100vh;
        }
    </style>
    <script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>
</head>
<body>

    <model-viewer
        id="ar-model"
        camera-controls
        touch-action="pan-y"
        autoplay
        ar
        ar-modes="scene-viewer webxr quick-look"
        scale="0.2 0.2 0.2"
        shadow-intensity="1"
        src="honey.glb" 
        ios-src="honey.usdz" 
        alt="Honey Badger"
    >
    </model-viewer>

    <script>
        const modelViewer = document.getElementById('ar-model');

        // Define your sound URL for Android Scene Viewer
        const androidSoundUrl = 'happy.mp3'

        // Function to create the custom AR intent for Android Scene Viewer
        function createSceneViewerIntent(modelUrl, title, soundUrl) {
            const baseUrl = 'intent://arvr.google.com/scene-viewer/1.2';
            const params = new URLSearchParams();
            params.append('file', modelUrl);
            params.append('title', title);
            params.append('sound', soundUrl); // Add your sound here!
            params.append('referrer', 'your-website.com:AR_EXPERIENCE'); // Customize referrer

            // Other potential parameters you might want from the model-viewer
            // e.g., scale, auto-place, etc. For simplicity, we'll keep it basic for now.

            const fallbackUrl = `https://arvr.google.com/scene-viewer?${params.toString()}`;

            return `${baseUrl}?${params.toString()}#Intent;package=com.google.android.googlequicksearchbox;scheme=https;S.browser_fallback_url=${encodeURIComponent(fallbackUrl)};end;`;
        }

        // Override the default AR button behavior for Android to inject sound
        modelViewer.addEventListener('ar-button-activated', (event) => {
            // Only apply this custom logic if the platform is Android and Scene Viewer is the mode
            if (event.detail.arStatus === 'not-presenting' && modelViewer.arStatus === 'not-presenting' && navigator.userAgent.includes('Android')) {
                // Check if the user agent is Android to ensure we target Scene Viewer
                const glbUrl = modelViewer.src;
                const altText = modelViewer.alt;

                const customIntentUrl = createSceneViewerIntent(glbUrl, altText, androidSoundUrl);

                // This will trigger the Scene Viewer directly with your custom intent
                window.location.href = customIntentUrl;

                // Prevent model-viewer's default AR launch for Android, as we've handled it
                event.preventDefault(); 
            }
        });
        
        // Ensure that the iOS Quick Look works as expected by just providing the ios-src
        // model-viewer will handle the click for `ios-src` automatically.

    </script>
</body>
</html>
